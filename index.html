<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Stock Portfolio Management System</title>
    <!-- Load React -->
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <!--Babel for JSX -->
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <!-- Roboto from Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
    <div id="container"></div>

    <script type="text/babel">

    class Stock extends React.Component{
      constructor(props) {
        super(props);
        this.state = {count: 0};

        this.remove = this.remove.bind(this);
        this.increase = this.increase.bind(this);
        this.decrease = this.decrease.bind(this);
      }

      remove() {
        this.props.deleteFromPortfolio(this.props.index)
      }

      increase() {
        this.setState({
    			count: this.state.count + 1
    			});
          this.props.bacon(this.state.count, this.props.index)
      }

      decrease() {
        this.setState({
          count: this.state.count - 1
          });
          this.props.bacon(this.state.count, this.props.index)
      }

      render() {
        return(
          <tr>
            <td>
              {this.props.children}
            </td>
            <td>
              0 $
            </td>
            <td>
              {this.state.count}
              <button onClick={this.increase} className="button-danger">+</button>
              <button onClick={this.decrease} className="button-danger">-</button>
            </td>
            <td>
              0 $
            </td>
            <td>
            <button onClick={this.remove} className="button-danger">X</button>
            </td>
          </tr>
        );
      }
    };



    class Portfolio extends React.Component{
      constructor(props) {
        super(props);
        this.state = {stocks: [], amounts: [], editing: false, adding: false};

        this.edit = this.edit.bind(this);
        this.remove = this.remove.bind(this);
        this.save = this.save.bind(this);
        this.cancel = this.cancel.bind(this);

        this.addNewStock = this.addNewStock.bind(this);
        this.cancelNewStock = this.cancelNewStock.bind(this);
        this.updateStock = this.updateStock.bind(this);
        this.removeStock = this.removeStock.bind(this);
        this.eachStock = this.eachStock.bind(this);
        this.addStock = this.addStock.bind(this);

        this.bacon = this.bacon.bind(this);
      }

      addNewStock() {
        this.setState({adding: true})
      }

      cancelNewStock() {
        this.setState({adding: false})
      }

      edit() {
        this.setState({editing: true})
      }

      remove() {
        this.props.deleteFromBoard(this.props.index)
      }

      save() {
        this.props.updatePortfolioName(this.refs.newName.value, this.props.index)
        this.setState({editing: false})
      }

      cancel() {
        this.setState({editing: false})
      }

      addStock() {
        name = this.refs.addStockName.value;
        var arr = this.state.stocks;
        if (arr.length < 50){
          arr.push(name);
          this.setState({stocks: arr})
          console.log('Adding stock: ' + name);
        } else {
          console.log('Maximum number of different stocks');
          alert("You already have the maximum amount of different stocks");
        }
        this.setState({adding: false})
      }

      removeStock(i) {
        console.log('Removing stock: ' + i);
        var arr = this.state.stocks;
        arr.splice(i, 1);
        this.setState({stocks: arr})
      }

      updateStock(newAmount, i) {
        console.log('Updating stock: ' + i);
        var arr = this.state.amounts;
        arr[i] = newAmount;
        this.setState({stocks: arr})
      }

      bacon(newAmount, i) {
        console.log('Updating bacon: ' + i);
        var arr = this.state.amounts;
        arr[i] = newAmount;
        this.setState({amounts: arr})
      }

      eachStock(name, i) {
        return (
                  <Stock key={i} index={i} updateStockAmount={this.updateStock} deleteFromPortfolio={this.removeStock} bacon={this.bacon}>
                  {name}
                  </Stock>
                );
      }

      render() {
        return(
          <div className="portfolioContainer">
            <button onClick={this.remove} className="button-danger">X</button>
            <div className="portfolioName">{this.props.children}</div>

            <div id="table-wrapper">
              <div id="table-scroll">
                <table>
                    <thead>
                        <tr>
                            <th><span className="text">Name</span></th>
                            <th><span className="text">Unit value</span></th>
                            <th><span className="text">Quantity</span></th>
                            <th><span className="text">Total value</span></th>
                            <th><span className="text">Select</span></th>
                        </tr>
                    </thead>
                    <tbody>
                      {this.state.stocks.map(this.eachStock)}
                    </tbody>
                </table>
              </div>
            </div>
            <p>Enter stock symbol:</p>
            <textarea ref="addStockName" defaultValue="Default Stock"></textarea>
            <button onClick={this.addStock} className="button-default">Add stock</button>
          </div>
        );
      }
    };



    class Board extends React.Component{
      constructor(props) {
        super(props);
        this.state = {portfolios: [], creating: false};

        this.add = this.add.bind(this);
        this.cancel = this.cancel.bind(this);
        this.updatePortfolio = this.updatePortfolio.bind(this);
        this.removePortfolio = this.removePortfolio.bind(this);
        this.eachPortfolio = this.eachPortfolio.bind(this);
        this.addPortfolio = this.addPortfolio.bind(this);
      }

      add() {
        this.setState({creating: true})
      }

      cancel() {
        this.setState({creating: false})
      }

      addPortfolio() {
        name = this.refs.addName.value;
        var arr = this.state.portfolios;
        if (arr.length < 10){
          arr.push(name);
          this.setState({portfolios: arr})
          console.log('Adding portfolio: ' + name);
          //this.setState({creating: false})
        } else {
          console.log('Maximum number of portfolios');
          alert("You already have the maximum amount of allowed portfolios");
        }
      }

      removePortfolio(i) {
        console.log('Removing portfolio: ' + i);
        var arr = this.state.portfolios;
        arr.splice(i, 1);
        this.setState({portfolios: arr})
      }

      updatePortfolio(newName, i) {
        console.log('Updating portfolio: ' + i);
        var arr = this.state.portfolios;
        arr[i] = newName;
        this.setState({portfolios: arr})
      }

      eachPortfolio(name, i) {
        return (
                  <Portfolio key={i} index={i} updatePortfolioName={this.updatePortfolio} deleteFromBoard={this.removePortfolio}>
                  {name}
                  </Portfolio>
                );
      }

      renderNormal() {
        return(
          <div>
            <button onClick={this.add} className="button-info">Create new portfolio</button>
            <div className="board">
              {this.state.portfolios.map(this.eachPortfolio)}
            </div>
          </div>
        );
      }

      renderForm() {
        return(
          <div>
            <button onClick={this.cancel} className="button-disabled">Create new portfolio</button>
            <p>Enter portfolio name:</p>
            <textarea ref="addName" defaultValue="Default Portfolio"></textarea>
            <button onClick={this.addPortfolio} className="button-confirm">Add</button>
            <div className="board">
              {this.state.portfolios.map(this.eachPortfolio)}
            </div>
          </div>
        );
      }

      render() {
        return(
          <div>
            <p>Enter portfolio name:</p>
            <textarea ref="addName" defaultValue="Default Portfolio"></textarea>
            <button onClick={this.addPortfolio} className="button-info">Add New Portfolio</button>
            <div className="board">
              {this.state.portfolios.map(this.eachPortfolio)}
            </div>
          </div>
        );
      }

      /*
      render() {
        return(
          <div>
            <textarea ref="test" defaultValue="Testing"></textarea>
            <button onClick={this.addPortfolio} className="button-info">Add portfolio</button>
            <div className="board">
              {this.state.portfolios.map(this.eachPortfolio)}
            </div>
          </div>
        );
      }
      */
    };

    ReactDOM.render(<Board />, document.getElementById('container'));

    </script>
  </body>
</html>
